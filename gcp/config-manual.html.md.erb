---
title: Configuring BOSH Director on GCP Manually
owner: Ops Manager
iaas: GCP
---

<strong><%= modified_date %></strong>
<html class="list-style-none"></html>

This topic describes how to configure the BOSH Director in Ops Manager for Pivotal Cloud Foundry (PCF) on Google Cloud Platform (GCP).

<p class="note"><strong>Note:</strong> You can also perform the procedures in this topic using the Ops Manager API. For more information, see the <a href="https://docs.pivotal.io/pivotalcf/<%= product_info['local_product_version'].to_s.sub('.','-') %>/customizing/ops-man-api.html">Using the Ops Manager API</a> topic.</p>


## <a id='access-om'></a> Step 1: Access Ops Manager

1. In a web browser, navigate to the fully qualified domain name (FQDN) of Ops Manager that you set up in [Deploying Ops Manager on GCP Manually](./deploy-manual.html).
    <p class="note"><strong>Note:</strong> In order to set up Ops Manager authentication correctly, Pivotal recommends using a Fully Qualified Domain Name (FQDN) to access Ops Manager. Using an ephemeral IP address to access Ops Manager can cause authentication errors upon subsequent access.</p>

1. When Ops Manager starts for the first time, you must choose one of the following:
    * [Use an Identity Provider](#idp): If you use an Identity Provider, an external identity server maintains your user database.
    * [Internal Authentication](#internal): If you use Internal Authentication, Ops Manager maintains your user database.

    <%= image_tag("../common/images/select-authentication.png") %>

### <a id='idp'></a> Use an Identity Provider (IdP)

<%= partial '../common/using_idp_ops_manager' %>

### <a id='internal'></a> Internal Authentication

1.  When redirected to the **Internal Authentication** page, do the following:
    * Enter a **Username**, **Password**, and **Password confirmation** to create an Admin user.
    * Enter a **Decryption passphrase** and the **Decryption passphrase confirmation**. This passphrase encrypts the Ops Manager datastore, and is not recoverable if lost.
    * If you are using an **HTTP proxy** or **HTTPS proxy**, follow the instructions in the [Configuring Proxy Settings for the BOSH CPI](https://docs.pivotal.io/pivotalcf/<%= product_info['local_product_version'].to_s.sub('.','-') %>/customizing/pcf-director-proxy-settings.html) topic.
    * Read the **End User License Agreement**, and select the checkbox to accept the terms.
    * Click **Setup Authentication**.

 	<%= image_tag("../common/images/om-login.png") %>

1. Log in to Ops Manager with the Admin username and password that you created in the previous step.

    <%= image_tag("../common/images/cf-login.png") %>


## <a id='gcp-config'></a> Step 2: Google Cloud Platform Config

1. Click the **Google Cloud Platform** tile within the **Installation Dashboard**.
    <%= image_tag("../common/images/gcp/director-tile-gcp.png") %>

1. Select **Google Config**. Complete the following fields:
    * **Project ID**: Enter your GCP project ID in lowercase, such as: `your-gcp-project-id`.
    * **Default Deployment Tag**: Enter the prefix that you used when creating the GCP resources for this PCF installation. For example, `pcf`.
    * Select **AuthJSON** and in the field below enter the contents of the JSON file that you downloaded in the [Set up an IAM Service Account](./prepare-env-manual.html#iam_account) section of the _Preparing to Deploy Ops Manager on GCP Manually_ topic.
        <p class="note"><strong>Note:</strong> As an alternative, you can select <strong>The Ops Manager VM Service Account</strong> option to use the service account automatically created by GCP for the Ops Manager VM. To use this option, the project-wide service account that you set up in [Set up an IAM Service Account](./prepare-env-manual.html#iam_account) must be assigned the **Service Account Actor** role.</p>
       <%= image_tag("../common/images/gcp/google_config.png") %>
1. Click **Save**.


## <a id='director-config'></a> Step 3: Director Config Page

1. Select **Director Config** to open the **Director Config** page.

    <%= image_tag("../common/images/gcp/director_gcp.png") %>

1. In the **NTP Servers (comma delimited)** field, enter `169.254.169.254` to designate the `metadata.google.internal` host as NTP server.
    <p class="note"><strong>Note:</strong> The NTP server configuration only updates after VM recreation. Ensure that you select the <strong>Recreate all VMs</strong> checkbox if you modify the value of this field.</p>

1. Leave the **JMX Provider IP Address** field blank.
    <p class="note"><strong>Note:</strong> Starting from PCF v2.0, BOSH-reported component metrics are available in the Loggregator Firehose by default. Therefore, if you continue to use PCF JMX Bridge for consuming them outside of the Firehose, you might receive duplicate data. To prevent this, leave the <strong>JMX Provider IP Address</strong> field blank. For additional guidance, see <a href="http://docs.pivotal.io/pivotalcf/2-0/pcf-release-notes/runtime-rn.html#bosh-metrics">BOSH System Metrics Available in Loggregator Firehose</a>.</p>

1. Leave the **Bosh HM Forwarder IP Address** field blank.
    <p class="note"><strong>Note:</strong> Starting from PCF v2.0, BOSH-reported component metrics are available in the Loggregator Firehose by default. Therefore, if you continue to use the BOSH HM Forwarder for consuming them, you might receive duplicate data. To prevent this, leave the <strong>Bosh HM Forwarder IP Address</strong> field blank. For additional guidance, see <a href="http://docs.pivotal.io/pivotalcf/2-0/pcf-release-notes/runtime-rn.html#bosh-metrics">BOSH System Metrics Available in Loggregator Firehose</a>.</p>

1. Select the **Enable VM Resurrector Plugin** checkbox to enable the Ops
Manager Resurrector functionality and increase Pivotal Application Service (PAS) availability.

1. Select **Enable Post Deploy Scripts** to run a post-deploy script after deployment. This script allows the job to execute additional commands against a deployment.
  <p class="note"><strong>Note:</strong> You must enable post-deploy scripts to install PKS.</p>

1. (Optional) Select **Recreate all VMs** to force BOSH to re-create all VMs on the next deploy. This process does not destroy any persistent disk data.

1. Select **Enable bosh deploy retries** for Ops Manager to retry failed BOSH operations up to five times.

1. <%= partial '../common/legacy-deploys' %>

1. (Optional) Select **Keep Unreachable Director VMs** if you want to preserve BOSH Director VMs after a failed deployment for troubleshooting purposes.

1. (Optional) Select **HM Pager Duty Plugin** to enable Health Monitor integration with PagerDuty.
    <%= image_tag("../common/images/director_hm_pager.png") %>
    * **Service Key**: Enter your API service key from PagerDuty.
    * **HTTP Proxy**: Enter an HTTP proxy for use with PagerDuty.

1. (Optional) Select **HM Email Plugin** to enable Health Monitor integration with email.
     <%= image_tag("../common/images/director_hm_email.png") %>
    * **Host**: Enter your email hostname.
    * **Port**: Enter your email port number.
    * **Domain**: Enter your domain.
    * **From**: Enter the address for the sender.
    * **Recipients**: Enter comma-separated addresses of intended recipients.
    * **Username**: Enter the username for your email server.
    * **Password**: Enter the password for your email server.
    * **Enable TLS**: Select this checkbox to enable Transport Layer Security.

1. <%= partial "../common/credhub-encryption" %>

1. <%= partial "../common/blobstore-location" %>

1. For **Database Location**, if you configured an external MySQL database such as Cloud SQL, select **External MySQL Database** and complete the fields below. Otherwise, select **Internal**. For more information about creating a Cloud SQL instance, see [Quickstart for Cloud SQL for MySQL](https://cloud.google.com/sql/docs/mysql/quickstart) in the Google Cloud documentation.
    * **Host:** Enter the value of your host.
    * **Port:** Enter your port number. For example, `3306`.
    * **Username:** Enter your username.
    * **Password:** Enter your password.
    * **Database:** Enter your database name.<br>
In addition, if you selected the **Enable TLS for Director Database** checkbox, you can fill out the following optional fields:
    * **Enable TLS:** Selecting this checkbox enables TLS communication between the BOSH Director and the database.
    * **TLS CA:** Enter the Certificate Authority for the TLS Certificate.
    * **TLS Certificate:** Enter the client certificate for mutual TLS connections to the database.
    * **TLS Private Key:** Enter the client private key for mutual TLS connections to the database.
    * **Advanced DB Connection Options:** If you would like to provide additional options for the database, use this field to provide a JSON-formatted options string.

1. (Optional) Modify the **Director Workers** value, which sets the number of workers available to execute Director tasks. This field defaults to `5`.

1. (Optional) **Max Threads** sets the maximum number of threads that the BOSH Director can run simultaneously. Pivotal recommends that you leave the field blank to use the default value, unless doing so results in rate limiting or errors on your IaaS.

1. (Optional) To add a custom URL for your BOSH Director, enter a valid hostname in **Director Hostname**. You can also use this field to configure [a load balancer in front of your BOSH Director](https://community.pivotal.io/s/article/How-to-Set-Up-a-Load-Balancer-in-Front-of-Ops-Manager-Director).
     <p class="note warning"><strong>WARNING:</strong> In Ops Manager v2.2.7 and earlier, if you change the <strong>Director
  Hostname</strong> after your initial deployment, VMs become unavailable. This causes downtime for your environment. To restore VM availability, enable **Recreate All VMs** and redeploy. This issue is resolved in <a href="https://docs.pivotal.io/pivotalcf/<%= product_info['local_product_version'].to_s.sub('.','-') %>/pcf-release-notes/opsmanager-rn.html#2-2-8">Ops Manager v2.2.8</a> and later.</p>

     <%= image_tag("../common/images/director_workers.png") %>

1. <%= partial "../common/exclude-recursors" %>

1. <%= partial "../common/disable_bosh_dns" %>
    <p class="note"><strong>Note:</strong> Disabling BOSH DNS affects <a href="#network">Step 5: Create Networks Page</a> below when you configure your network DNS.</p>
    <p class="note breaking"><strong>Breaking Change:</strong> Do not disable BOSH DNS without consulting Pivotal Support.</p>
    <p class="note"><strong>Note:</strong> If you are deploying PKS, do not disable BOSH DNS. If PAS and PKS are running on the same instance of Ops Manager, you cannot use the opt-out feature of BOSH DNS for your PAS without breaking PKS. If you want to opt out of BOSH DNS in your PAS deployment, install the tile on a separate instance of Ops Manager.</p>

1. (Optional) To set a custom banner that users see when logging in to the Director using SSH, enter text in the **Custom SSH Banner** field.
   <%= image_tag("../common/images/disable-bosh-dns.png") %>

1. <%= partial "../common/identification-tags" %>

1. Click **Save**.


## <a id='az'></a> Step 4: Create Availability Zones Page
  <div class="note"><strong>Note:</strong> Pivotal recommends at least three availability zones for a highly available installation.
    <ul>
      <li>For configuring a PAS deployment with multiple availability zones, see <a href="https://docs.pivotal.io/pivotalcf/<%= product_info['local_product_version'].to_s.sub('.','-') %>/refarch/gcp/gcp_ref_arch.html">Reference Architecture for Pivotal Cloud Foundry on GCP</a>.</li>
      <li>For PKS best practices for distributing workloads across multiple availability zones and clusters, see <a href="https://docs.pivotal.io/runtimes/pks/1-2/maintain-uptime.html">Maintaining Workload Uptime</a>.</li>
    </ul>
  </div>
1. Select **Create Availability Zones**.

1. Click **Add**.

1. For **Google Availability Zone**:
    * Enter one of the zones that you associated to the backend service instance groups of the HTTP(S) Load Balancer. For example, if you are using the `us-central1` region and selected `us-central1-a` as one of the zones for your HTTP(S) Load Balancer instance groups, enter `us-central1-a`.
    * Click **Add**.
    * Repeat the above step for all the availability zones that you associated to instance groups in [Preparing to Deploy Ops Manager on GCP Manually](./prepare-env-manual.html#create-http-and-instance-group).
    <%= image_tag("../common/images/gcp/availability_zones_multiple.png") %>
    * Click **Save**.

1. Repeat the above step for all the availability zones you are using in your deployment. When you are done, click **Save**.


## <a id='network'></a> Step 5: Create Networks Page

1. Select **Create Networks**.

1. Make sure **Enable ICMP checks** is not selected. GCP routers do not respond to ICMP pings.

1. Click **Add Network** to create the following three networks:
    <p class="note"><strong>Note:</strong> To use a shared VPC network, enter the shared VPC host project name before the network name in the format <code>VPC-PROJECT-NAME/NETWORK-NAME/SUBNET-NAME/REGION-NAME</code>.
    For example, <code>vpc-project/opsmgr/central/us-central1</code>.
    For more information, see <a href="https://docs.pivotal.io/pivotalcf/<%= product_info['local_product_version'].to_s.sub('.','-') %>/customizing/gcp-shared-vpc.html">Configuring a Shared VPC on GCP</a>.<br><br>
    If you disabled BOSH DNS for a PAS installation, enter <code>8.8.8.8</code> into the **DNS Servers** field of the PAS tile. For more information, see step 29g in the <em>Configure Networking</em> section of the <a href="https://docs.pivotal.io/pivotalcf/<%= product_info['local_product_version'].to_s.sub('.','-') %>/customizing/gcp-er-config.html#dns-servers">Deploying PAS on GCP</a> topic.</p>
    <h3>Infrastructure Network</h3>
    <table>
      <tr>
        <th>Network Name</th>
        <td><code>infrastructure</code></td>
      </tr>
      <tr>
        <th>Google Network Name</th>
          <td>Enter the name of the infrastructure network that you created in the <a href="prepare-env-manual.html#create_network">Create a GCP Network with Subnets</a> step of <em>Preparing to Deploy Ops Manager on GCP Manually</em>. <br>The format is: <code>pcf-virt-net/pcf-infrastructure-subnet-MY-REGION/MY-GCP-REGION</code></td>
      </tr>
      <tr>
        <th>CIDR</th>
        <td>Enter the name of the CIDR ending in <code>/26</code> that you used when you created the infrastructure subnet in GCP. <br>Example: <code>192.168.101.0/26</code></td>
      </tr>
      <tr>
        <th>Reserved IP Ranges</th>
        <td>Enter the first <code>.1</code> through <code>.9</code> addresses from the CIDR. For example, if the CIDR is <code>192.168.101.0/26</code>, enter the range <code>192.168.101.1-192.168.101.9</code>.</td>
      </tr>
      <tr>
        <th>DNS</th>
        <td><code>169.254.169.254</code></td>
      </tr>
      <tr>
        <th>Gateway</th>
        <td>Enter the first <code>.1</code> address from the CIDR. For example, if the CIDR is <code>192.168.101.0/26</code>, enter <code>192.168.101.1</code>.</td>
      </tr>
      <tr>
        <th>Availability Zones</th>
        <td>Select all three availability zones.</td>
      </tr>
    </table>
    <h3>Runtime Network</h3>
    <table>
      <tr>
        <th>Name</th>
        <td>Enter the name of the runtime that you intend to deploy in this environment. For example, <code>pas</code> or <code>pks</code>.</td>
      </tr>
      <tr>
        <th>Google Network Name</th>
        <td>Enter the name of the runtime network that you created when you prepared your GCP environment. <br>The format is: <code>pcf-virt-net/pcf-RUNTIME-subnet-MY-REGION/MY-GCP-REGION</code></td>
      </tr>
      <tr>
        <th>CIDR</th>
        <td>Enter the name of the CIDR ending in <code>/22</code> that you used when you created the runtime subnet in GCP. <br>Example: <code>192.168.16.0/22</code></td>
      </tr>
      <tr>
        <th>Reserved IP Ranges</th>
        <td>Enter the first <code>.1</code> through <code>.9</code> addresses from the CIDR. For example, if the CIDR is <code>192.168.16.0/22</code>, enter the range <code>192.168.16.1-192.168.16.9</code>.</td>
      </tr>
      <tr>
        <th>DNS</th>
        <td><code>169.254.169.254</code></td>
      </tr>
      <tr>
        <th>Gateway</th>
        <td>Enter the first <code>.1</code> address from the CIDR. For example, if the CIDR is <code>192.168.16.0/22</code>, enter <code>192.168.16.1</code>.</td>
      </tr>
      <tr>
        <th>Availability Zones</th>
        <td>Select all three availability zones.</td>
      </tr>
    </table>
    <h3>Services Network</h3>
    <table>
      <tr>
        <th>Network Name</th>
        <td><code>services</code></td>
      </tr>
      <tr>
        <th>Google Network Name</th>
        <td>Enter the name of the services network that you created when you prepared your GCP environment. <br>The format is: <code>pcf-virt-net/pcf-services-subnet-MY-REGION/MY-GCP-REGION</code></td>
      </tr>
      <tr>
        <th>CIDR</th>
        <td>Enter the name of the CIDR ending in <code>/22</code> that you used when you created the services subnet in GCP. <br>Example: <code>192.168.20.0/22</code></td>
      </tr>
      <tr>
        <th>Reserved IP Ranges</th>
        <td>Enter the first <code>.1</code> through <code>.9</code> addresses from the CIDR. For example, if the CIDR is <code>192.168.20.0/22</code>, enter the range <code>192.168.20.1-192.168.20.9</code>.</td>
      </tr>
      <tr>
        <th>DNS</th>
        <td><code>169.254.169.254</code></td>
      </tr>
      <tr>
        <th>Gateway</th>
        <td>Enter the first <code>.1</code> address from the CIDR. For example, if the CIDR is <code>192.168.16.0/22</code>, enter <code>192.168.16.1</code>.</td>
      </tr>
      <tr>
        <th>Availability Zones</th>
        <td>Select all three availability zones.</td>
      </tr>
    </table>
    <%= vars.expand_network_azs %>

    <p class="note"><strong>Note:</strong> Ensure <code>169.254.169.254</code>, the IP address of the <code>metadata.google.internal</code> metadata server, 
    is always specified at the beginning of this step's DNS resolver lists.</p>   

## <a id="assign-azs"></a> Step 6: Assign AZs and Networks Page

1. Select **Assign AZs and Networks**.

1. Use the dropdown to select a **Singleton Availability Zone**. The BOSH Director installs in this Availability Zone.

1. Under **Network**, select the `infrastructure` network for your BOSH Director.

1. Click **Save**.


## <a id='security'></a> Step 7: Security Page

<%= partial "../common/security-pane" %>

## <a id='syslog'></a> Step 8: Syslog Page

<%= partial '../common/syslog_bosh' %>

## <a id='resource-config'></a> Step 9: Resource Config Page

1. Select **Resource Config**.

1. Ensure that the **Internet Connected** checkboxes are not selected for any jobs. The checkbox gives VMs a public IP address that enables outbound internet access. In [Preparing to Deploy Ops Manager on GCP Manually](./prepare-env-manual.html), you provisioned a Network Address Translation (NAT) box to provide internet connectivity to your VMs. For more information about using NAT in GCP, see the <a href="https://cloud.google.com/compute/docs/networking">GCP documentation</a>.

<p class="note"><strong>Note:</strong> If you install PAS for Windows, provision your <strong>Master Compilation Job</strong> with at least 100&nbsp;GB of disk space.</p>


## <a id="custom-vm-extensions"></a> Step 10: (Optional) Add Custom VM Extensions

<%= partial "../common/vm-extension-config"  %>

## <a id='complete'></a> Step 11: Complete the BOSH Director Installation

1. Click the **Installation Dashboard** link to return to the Installation Dashboard.

1. Click **Apply Changes**. If the following ICMP error message appears, return to the [Network Config](#network) screen, and ensure you have deselected the **Enable ICMP Checks** box. Then click **Apply Changes** again.

    <%= image_tag("../common/images/cloudform/install-error.png") %>

1. BOSH Director installs. This might take a few moments. When the installation process successfully completes, the **Changes Applied** window appears.

    <%= image_tag("../common/images/cloudform/ops-manager-complete.png") %>

## <a id="next"></a> Next Steps

After you complete this procedure, follow the instructions for the runtime you intend to install.
<ul>
  <li>To deploy PAS, see [Deploying PAS on GCP](https://docs.pivotal.io/pivotalcf/<%= product_info['local_product_version'].to_s.sub('.','-') %>/customizing/gcp-er-config.html).</li>
  <li>To prepare to deploy PKS, see Installing PKS on [Google Cloud Platform (GCP)](https://docs.pivotal.io/runtimes/pks/1-2/gcp-index.html).</li>
<ul>
